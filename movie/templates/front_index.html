{% extends "front_layout.html" %}
{% load static %}
{% block title %}首页{% endblock %}

{% block css %}
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
<link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}">
<link rel="stylesheet" href="{% static 'assets/css/style-starter.css' %}">
<style>
    .carousel-container {
        width: 100%;
        overflow: hidden;
        position: relative;
        height: 100vh;
    }
    .carousel-img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: scale(1.1);
        opacity: 0;
        transition:
            transform 1.8s ease-out,
            opacity 1s ease-in-out;
    }

    .carousel-img.active {
        transform: scale(1);
        opacity: 1;
        z-index: 2;
    }
    .carousel-img.prev {
        transform: scale(1);
        opacity: 0;
        z-index: 1;
    }
    .carousel-dots {
        position: absolute;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 10;
    }
    .carousel-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255,255,255,0.7);
        cursor: pointer;
        transition: background 0.3s ease;
    }
    .carousel-dot.active {
        background: #e74c3c;
    }

    .transition-colors {
        transition: color 0.3s ease;
    }
</style>
{% endblock %}

{% block js %}
<script src="{% static 'assets/js/jquery-3.3.1.min.js' %}"></script>
<script src="{% static 'assets/js/bootstrap.min.js' %}"></script>
<script src="{% static 'assets/js/owl.carousel.js' %}"></script>
<script src="{% static 'assets/js/theme-change.js' %}"></script>
<script>
    $(document).ready(function() {
        const imgs = $('.carousel-img');
        const dots = $('.carousel-dot');
        let currentIndex = 0;
        const scaleDuration = 2000;
        const stayDuration = 1800;
        const fadeOverlap = 500;

        imgs.eq(currentIndex).addClass('active');

        function changeSlide(index) {
            imgs.eq(currentIndex).removeClass('active').addClass('prev');

            setTimeout(() => {
                imgs.removeClass('prev');
            }, fadeOverlap);

            currentIndex = index;
            imgs.eq(currentIndex).addClass('active').removeClass('prev');

            dots.removeClass('active');
            dots.eq(currentIndex).addClass('active');
        }

        function autoSlide() {
            setTimeout(() => {
                const nextIndex = (currentIndex + 1) % imgs.length;
                changeSlide(nextIndex);
                autoSlide();
            }, scaleDuration + stayDuration - fadeOverlap);
        }

        autoSlide();

        dots.click(function() {
            const index = $(this).index();
            if (index !== currentIndex) {
                changeSlide(index);
            }
        });
    });
</script>
{% endblock %}

{% block main-container %}
    <!-- 轮播区域 -->
    <section class="carousel-container" id="home">
        <img src="{% static 'assets/images/banner1.jpg' %}" class="carousel-img" alt="轮播图1">
        <img src="{% static 'assets/images/banner2.jpg' %}" class="carousel-img" alt="轮播图2">
        <img src="{% static 'assets/images/banner3.jpg' %}" class="carousel-img" alt="轮播图3">
        <img src="{% static 'assets/images/banner4.jpg' %}" class="carousel-img" alt="轮播图4">

        <div class="carousel-dots">
            <div class="carousel-dot active"></div>
            <div class="carousel-dot"></div>
            <div class="carousel-dot"></div>
            <div class="carousel-dot"></div>
        </div>
    </section>

    <section class="w3l-courses py-5" id="hot-movies" style="margin-top: -5px;">
        <div class="container pb-lg-5 pb-md-4 pb-2">
            <h5 class="sub-title text-center">正在热映</h5>
            <div class="row">
                {% for obj in queryset_hot %}
                    <div class="col-lg-3 col-md-4 col-sm-6 item mb-4">
                        <div class="card">
                            <a href="/movie/{{ obj.movie_ID }}/details/">
                                <img class="card-img-top" src="{{ obj.poster }}" alt="{{ obj.name }}海报"
                                     style="height: 300px; object-fit: cover; width: 100%;">
                            </a>
                            <div class="card-body">
                                <h4 class="card-title">{{ obj.name }}</h4>
                                <div class="rating text-warning">
                                    <i class="fa fa-star star" aria-hidden="true"></i>
                                    <i class="fa fa-star star" aria-hidden="true"></i>
                                    <i class="fa fa-star star" aria-hidden="true"></i>
                                    <i class="fa fa-star star" aria-hidden="true"></i>
                                    <i class="fa fa-star-half-o star" aria-hidden="true"></i>
                                    <span>{{ obj.movie_score }}/10</span>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <section class="w3l-courses py-5 bg-light" id="high-rated">
        <div class="container pb-lg-5 pb-md-4 pb-2">
            <h5 class="sub-title text-center">高分推荐</h5>
            <div class="row">
                {% for obj in queryset_high %}
                    <div class="col-lg-3 col-md-4 col-sm-6 item mb-4">
                        <div class="card">
                            <a href="/movie/{{ obj.movie_ID }}/details/">
                                <img class="card-img-top" src="{{ obj.poster }}" alt="{{ obj.name }}海报"
                                     style="height: 300px; object-fit: cover; width: 100%;">
                            </a>
                            <div class="card-body">
                                <h4 class="card-title">{{ obj.name }}</h4>
                                <a style="color: #ff9800; font-weight: bold;">{{ obj.movie_score }}/10</a>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <footer class="bg-dark text-light py-4">
        <div class="container">
            <div class="row justify-content-between align-items-center">
                <div class="col-md-6">
                    <div class="d-flex align-items-center">
                        <i class="fa fa-film text-danger mr-2" style="font-size: 1.2em;"></i>
                        <span>© 2025 推荐电影</span>
                    </div>
                    <p class="mt-2 text-muted small">专注于为您推荐优质电影，发现光影魅力</p>
                </div>
                <div class="col-md-4 text-md-right">
                    <div class="d-flex justify-content-end gap-3">
                        <a href="#" class="text-light hover:text-danger transition-colors">
                            <i class="fa fa-weibo" style="font-size: 1.2em;"></i>
                        </a>
                        <a href="#" class="text-light hover:text-danger transition-colors">
                            <i class="fa fa-wechat" style="font-size: 1.2em;"></i>
                        </a>
                        <a href="#" class="text-light hover:text-danger transition-colors">
                            <i class="fa fa-instagram" style="font-size: 1.2em;"></i>
                        </a>
                    </div>
                    <p class="mt-2 text-muted small">联系我们：movie@example.com</p>
                </div>
            </div>
        </div>
    </footer>
{% endblock %}